<!doctype html>
<html lang="tr" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>İSG Denetim Uygulaması</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#2563eb">
  <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
  
  <link id="manifest-placeholder" rel="manifest">

  <script>
    // Manifest dosyasını hatasız oluşturur
    (function() {
      const manifest = {
        "name": "İSG Denetim Sistemi",
        "short_name": "İSG Form",
        "start_url": ".",
        "display": "standalone",
        "background_color": "#ffffff",
        "theme_color": "#2563eb",
        "icons": [{
          "src": "https://cdn-icons-png.flaticon.com/512/3135/3135715.png",
          "sizes": "512x512",
          "type": "image/png"
        }]
      };
      const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
      const manifestURL = URL.createObjectURL(blob);
      document.querySelector('#manifest-placeholder').setAttribute('href', manifestURL);
    })();
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    
    .question-card {
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      background: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      margin-bottom: 1rem;
      padding: 1rem;
    }
    .question-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    @keyframes borderBlink {
      0%, 100% { box-shadow: 0 0 0 4px rgba(220, 38, 38, 0); }
      50% { box-shadow: 0 0 0 4px rgba(220, 38, 38, 1); }
    }
    .blink-border {
      animation: borderBlink 0.5s ease-in-out 4;
    }
    .question-card.answer-yes {
      border-color: #10b981;
      background: linear-gradient(to bottom, white, #f0fdf4);
    }
    .question-card.answer-no {
      border-color: #ef4444;
      background: linear-gradient(to bottom, white, #fef2f2);
    }
    .question-card.answer-na {
      border-color: #eab308;
      background: linear-gradient(to bottom, white, #fefce8);
    }
    .btn-answer {
      border: 2px solid;
      background: white;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 8px;
    }
    .btn-yes { color: #059669; border-color: #10b981; }
    .btn-yes.selected { background: #10b981; color: white; }
    .btn-no { color: #dc2626; border-color: #ef4444; }
    .btn-no.selected { background: #ef4444; color: white; }
    .btn-na { color: #eab308; border-color: #eab308; }
    .btn-na.selected { background: #eab308; color: white; }
    
    .modern-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-top: 4px;
      transition: all 0.2s;
    }
    .modern-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
  </style>
</head>
<body class="bg-gray-50">

  <div class="max-w-md mx-auto p-4 pb-24">
    <header class="mb-8 pt-4">
      <h1 class="text-2xl font-bold text-gray-900">İSG Denetim Formu</h1>
      <p class="text-gray-500 text-sm">Lütfen tüm alanları eksiksiz doldurun.</p>
    </header>

    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-6">
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-semibold text-gray-700">İlçe</label>
          <input type="text" id="school-district" class="modern-input" placeholder="İlçe adı giriniz">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700">Okul Adı</label>
          <input type="text" id="school-name" class="modern-input" placeholder="Okul adı giriniz">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700">Kurum Kodu</label>
          <input type="text" id="school-code" class="modern-input" placeholder="Kurum kodu">
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700">Denetim Tarihi</label>
          <input type="date" id="audit-date" class="modern-input">
        </div>
      </div>
    </div>

    <div class="question-card" id="q-container-1">
      <p class="text-gray-800 font-medium mb-4">1. Acil çıkış kapıları her zaman açık ve ulaşılabilir mi?</p>
      <div class="flex gap-2">
        <button onclick="setAnswer(1, 'Evet')" id="btn-1-yes" class="btn-answer btn-yes flex-1">Evet</button>
        <button onclick="setAnswer(1, 'Hayır')" id="btn-1-no" class="btn-answer btn-no flex-1">Hayır</button>
        <button onclick="setAnswer(1, 'Kapsam Dışı')" id="btn-1-na" class="btn-answer btn-na flex-1">K.D.</button>
      </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200 flex gap-3">
      <button onclick="generatePDF()" class="flex-1 bg-gray-100 text-gray-800 py-4 rounded-xl font-bold">PDF İndir</button>
      <button id="save-audit" class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-bold shadow-lg shadow-blue-200">Denetimi Kaydet</button>
    </div>
  </div>

  <script>
    // CEVAPLARI YÖNETEN SİSTEM
    let answers = {};
    function setAnswer(id, val) {
      answers[id] = val;
      const container = document.getElementById(`q-container-${id}`);
      container.className = `question-card answer-${val === 'Evet' ? 'yes' : val === 'Hayır' ? 'no' : 'na'}`;
      
      // Buton renklerini güncelle
      document.querySelectorAll(`#q-container-${id} .btn-answer`).forEach(b => b.classList.remove('selected'));
      if(val === 'Evet') document.getElementById(`btn-${id}-yes`).classList.add('selected');
      if(val === 'Hayır') document.getElementById(`btn-${id}-no`).classList.add('selected');
      if(val === 'Kapsam Dışı') document.getElementById(`btn-${id}-na`).classList.add('selected');
    }

    // VERİ GÖNDERME SİSTEMİ (GITHUB İÇİN)
    async function submitAudit() {
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxbS32AOKNTq4dAc1cDm0vlH8NYi9-NbHNkfydZuq4U4AsO3N5_TIJasyAHSbFwXa8L/exec";
        const btn = document.getElementById('save-audit');
        
        const data = {
            schoolDistrict: document.getElementById('school-district').value,
            schoolName: document.getElementById('school-name').value,
            schoolCode: document.getElementById('school-code').value,
            auditDate: document.getElementById('audit-date').value,
            questions: answers
        };

        if(!data.schoolName) return alert("Lütfen okul adını doldurun!");

        btn.innerText = "⏳ Kaydediliyor...";
        btn.disabled = true;

        try {
            await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });
            alert("✅ Başarıyla Google E-Tabloya kaydedildi!");
            location.reload();
        } catch (e) {
            alert("Hata oluştu: " + e);
            btn.disabled = false;
            btn.innerText = "Tekrar Dene";
        }
    }

    // Butonu bağla
    document.getElementById('save-audit').onclick = submitAudit;

    // PDF Üretme (Basit Örnek)
    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("İSG Denetim Raporu", 10, 10);
        doc.text(`Okul: ${document.getElementById('school-name').value}`, 10, 20);
        doc.save("denetim_raporu.pdf");
    }
  </script>
</body>
</html>